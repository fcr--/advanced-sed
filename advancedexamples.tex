%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Advanced Examples}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{uniq}

It's not really clear whether this example should be in the Advanced Examples
section, as it does not introduce nor require any non-obvious programming
patterns.

The {\tt uniq} program reads one line at a time from the standard input.
If it is equal to the previous line then it is skipped, otherwise it is printed
to the standard output.  Its pseudocode becomes extremely simple in a higher
level programming language like lua:

%\begin{figure}[h]
%	\label{code:luauniq}
	\begin{Verbatim}
	for line in io.lines() do
	  if line ~= previous_line then
	    print(line)
	    previous_line = line
	  end
	end
	\end{Verbatim}
%	\caption{Pseudocode for {\tt uniq} in lua 5.}
%\end{figure}

While the \sed version requires us to introduce one of the least common
commands, `{\tt N}':

% sedcode uniq:
\begin{Verbatim}
p; :a; $d; N
  s/\(.*\)\n\1$/\1/; ta
  s/.*\n//p; ba
\end{Verbatim}

Most of the time our sed programs usually contain a single `{\tt s}' command
and that's it; in those cases sed consumes one line at a time and the pattern
space, the main memory of the program, never contains newline characters:
`\verb|\n|'.  This program however is the exception.

Here our pattern space is used in two ways: It may either contain the text of a
single line, for example when the program begins; or it may as well have ``two
lines'' inside, precisely after the {\tt N} command.
`{\tt N}' reads the next line from the standard input and appends it to the
pattern space with a newline in the middle.

For instance if the input is composed of two lines: `{\tt a}' and `{\tt b}',
processing them with \verb|N;s/\n/-/| will result in `{\tt a-b}'.

Having this behavior is what allows us to write programs in which the lines
cannot be processed independently of one another.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Vigen\`ere}

% sedcode vigenere:
\begin{Verbatim}
	1{ h; d }
	G; s/^\|\n/&<ABCDEFGHIJKLMNOPQRSTUVWXYZA>/g
	:a
	  s/\(<[A-Z]*>\)\([^A-Z]\)\(.*\n\)/\2\1\3/
	  s/\(<.*\(.\)\(.\).*>\)\2\(.*<.*\(.\)\(.\).*>\)\6/\1\3\4\5/
	  /\n<.*>A/  s/\(<.*>\)\(.\)\(.*>\)./\2\1\3/
	  />$/{ G; s/>\n/>/ }
	  ta
	s/<.*//
\end{Verbatim}

\todo{add more examples}

% another advanced example could be a program to select child elements from
% json strings, the first line could be the selector like "foo".0."id", and the
% remaining lines could be json objects (which could span several lines
% themselves).
